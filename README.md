# Python Scripts for Ciliadnd Data Post-Processing

This repository contains Python scripts for post-processing simulation data related to the *ciliadnd* project. Below is a description of each script and its purpose.

---

## 1. `read_h5_files.py`

- **Purpose:** Scans directories containing simulation files and reads `database.h5` files.
- **Functionality:**
    - Extracts the values of `a` and `b` from each database file.
    - Records the file path of each `.h5` file.
    - Outputs a CSV file with columns: `a, b, path`.

---

## 2. `process_h5_files.py`

- **Purpose:** Processes each `database.h5` file listed in the CSV generated by `read_h5_files.py`.
- **Functionality:**
    - Reads steady-state tip deflections of cilia (when no particle is present in the flow, but the pressure difference is maintained).
    - Utilizes the `find_extreme_window` function from `generate_signatures.py` to analyze the database file using steady-state tip deflections.
    - Outputs two arrays:
        - Tip deflection of the cilia.
        - Mask indicating values above or below the steady-state deflection.
    - Generates four lists in total corresponding to the two components of cilia tip deflection. 
    - Saves the processed data as a pickle file named `simdata_tip.pkl`.

---

## 3. `generate_cilia_features.py`

- **Purpose:** Generates feature lists for each particle case based on cilia tip deflection data.
- **Functionality:**
    - Operates on either the x or y component of the tip deflections (configurable in the script).
    - For each signal:
        - Subtracts the steady-state deflection value.
        - Takes the absolute value to convert valleys to peaks, simplifying area calculations.
    - Currently calculates the following features:

        1. Maximum absolute deflection from steady state.
        2. Area under the signal.
        3. Signal width.
        4. Number of peaks in the signal.
    - Stores results as a list of lists (indexed by cilium and feature), where each element is a NumPy array: `ciliafeatures[icilia][ifeature]`.
---

## 4. `analyze_h5_databases.py`

- **Purpose:** Analyzes the final configuration of cilia and particles in each simulation to evaluate gate behavior and particle sorting performance.
- **Functionality:**
    - Uses Principal Component Analysis (PCA) to determine whether the last two cilia are in a **"closed" (vertical)** or **"open" (deflected)** state.
    - Classifies the gate configuration as:
        - `'sort_top'` if only the top cilium is vertical,
        - `'sort_bottom'` if only the bottom cilium is vertical,
        - `'undefined'` otherwise.
    - Computes the **percentage of particle nodes** located in the designated half (top or bottom) of the channel based on the gate state.
    - Calculates the **total number of full rotations** made by particles using `thetacum`.
    - Saves all results in a CSV file named `analysis_results.csv`.
---

## Notes

- Feature definitions in `generate_cilia_features.py` are subject to ongoing development.
- Ensure all dependencies (NumPy, pandas, h5py, etc.) are installed before running the scripts.

---


